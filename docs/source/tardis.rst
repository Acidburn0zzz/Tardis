Tardis
======
Tardis is the main program used to backup data to the database.  Normally tardis will be run on a daily basis via a cron job.

Tardis walks the list of backedup directories, and determines which data has changed, and pushes the data to the backup server.

Backup Sets
-----------
Tardis generates a new "backup set" each time it is run.  Normally, a backup set is a snapshot of the the backed up directories and files
as processed.

Each backup set has a name and a priority.  Normally, these names and priorities are generated by the server, with the first backup set saved
each month being named Monthly-year-month where year and month are the numeric year and month.  Each week, the first backup set of the week is named Weekly-year-week,
where year and week are the numeric year, and week in the year (00-52).  Other daily backups will be named Daily-year-month-day, where year, month and day are the
numeric year, month and day.  Monthly, weekly, and daily backups get a priority of 40, 30, and 20 respectively.

You can specify a specify name and priority and --keep options (--keep-days, --keep-hours, and --keep-time).

Purging Backup Sets
~~~~~~~~~~~~~~~~~~~
When run with the --purge option, tardis will cause a of old data to take place.  Normally, weekly backup sets are purged after 6 months (180 days), and daily backup sets are purged after 30 days.
Monthly backups are kept in perpetuity.   These values can be changed on the server.

However, the user can explicitly specify the priority and time to purge, on the command line, via the --purge-priority and --purge.  For instance, --purge --purge-priority 10 --keep-days 10
will cause any backup sets at priority 10 or lower, and older than 10 days old will be purged.

Specifying files
----------------
Tardis normally walks a list of directories as specified on the command line.  Tardis only backs up entire directories.  Tardis walks the directory trees below each specified directory
If you wish to exclude files from the backup, there are several ways.
    * /etc/tardis/excludes
        This file contains a list patterns of filenames to be excluded from any backup.  Format is one pattern per-line, and each
        pattern is a standard shell 'glob' pattern.  Patterns cannot span multiple directories.  These patterns will be applied to all directories processed.
        Example:
        If the file contains:
            tmp
            .*.swp
            foo*
        Any file or directory named tmp, and any files or directories which match .*.swp (ie, vim temporary files) or foo* (foo, foobar, etc)

        This name can be changed by setting the TARDIS_GLOBAL_EXCLUDES environment variable, or specifying it in the /etc/tardis/system.defaults file.
        If the --ignore-global-excludes option is specified, this file will not be read.
    * .tardis-excludes
        In any directory scanned, if there is a file named .tardis-excludes, it will be used for that directory, and all directories below it.  The format
        is the same as the global excludes file.
        This name can be changed by setting the TARDIS_EXCLUDES environment variable, or specifying it in the /etc/tardis/system.defaults file, or the --exclude-file-name option.
    * .tardis-local-excludes
        In any directory scanned, if there is a file named .tardis-local-excludes, it will be used for that directory, but will not be propagated into any
        lower directories.  The format is the same as the global excludes file.
        This name can be changed by setting the TARDIS_LOCAL_EXCLUDES environment variable, or specifying it in the /etc/tardis/system.defaults file, or the --local-exclude-file-name option.
    * .tardis-skip
        If a directory contains a file named .tardis-skip, the entire directory will be skipped, and all directories below.
        This name can be changed by setting the TARDIS_SKIP environment variable, or specifying it in the /etc/tardis/system.defaults file.
    * --exclude option
        If you specify --exclude, you can specify a pattern to be excluded.
        This option can be repeated multiple times.
    * --exclude-file option
        If you specify a --exclude-file, it will read a file containing a set of patterns to use globally.  This option can be repeated multiple times, and each file read.
    * --exclude-dir option
        You can specify directories to skip via the --exclude-dir option.  This will take a path to a directory to exclude entirely.  If the path is not a full pathname, it will be computed
        relative to the current working directory.  This option can be repeated multiple times.

Note that the files to be excluded in any directory are the union of all the above options.

Tardis takes the following options:

<pre>
usage: tardis [-h] [--server SERVER] [--port PORT] [--log [LOGFILES]]
              [--client CLIENT] [--force] [--timeout TIMEOUT]
              [--password [PASSWORD] | --password-file PASSWORDFILE |
              --password-prog PASSWORDPROG] [--crypt] [--keys KEYS]
              [--compress-data] [--compress-min MINCOMPSIZE]
              [--nocompress-types NOCOMPRESS] [--xattr] [--acl] [--local]
              [--local-server-cmd SERVERPROG]
              [--name NAME | --hourly | --daily | --weekly | --monthly]
              [--priority PRIORITY] [--maxdepth MAXDEPTH] [--crossdevice]
              [--basepath {none,common,full}] [--cvs-ignore]
              [--exclude EXCLUDES] [--exclude-file EXCLUDEFILES]
              [--exclude-file-name EXCLUDEFILENAME]
              [--exclude-dir EXCLUDEDIRS]
              [--local-exclude-file-name LOCALEXCLUDEFILENAME]
              [--skip-file-name SKIPFILENAME] [--ignore-global-excludes]
              [--compress-msgs] [--cks-content [CKSCONTENT]] [--clones CLONES]
              [--batchdir BATCHDIRS] [--batchsize BATCHSIZE]
              [--chunksize CHUNKSIZE] [--dirslice DIRSLICE]
              [--protocol {json,bson,msgp}] [--deltathreshold DELTATHRESHOLD]
              [--purge] [--purge-priority PURGEPRIOR]
              [--keep-days PURGEDAYS | --keep-hours PURGEHOURS | --keep-time PURGETIME]
              [--version] [--stats] [--report] [--verbose] [--log-exceptions]
              [directories [directories ...]]

Tardis Backup Client

positional arguments:
  directories           List of directories to sync

optional arguments:
  -h, --help            show this help message and exit
  --server SERVER, -s SERVER
                        Set the destination server. Default: localhost
  --port PORT, -p PORT  Set the destination server port. Default: 7420
  --log [LOGFILES], -l [LOGFILES]
                        Send logging output to specified file. Can be repeated
                        for multiple logs. Default: stderr
  --client CLIENT       Set the client name. Default: linux.koldware.com
  --[no]force           Force the backup to take place, even if others are
                        currently running
  --timeout TIMEOUT     Set the timeout to N seconds. Default: 300.0
  --[no]compress-data   Compress files. Default: False
  --compress-min MINCOMPSIZE
                        Minimum size to compress. Default: 4096
  --nocompress-types NOCOMPRESS
                        File containing a list of MIME types to not compress.
                        Default: None
  --[no]xattr           Backup file extended attributes
  --[no]acl             Backup file access control lists
  --priority PRIORITY   Set the priority of this backup
  --maxdepth MAXDEPTH, -d MAXDEPTH
                        Maximum depth to search
  --[no]crossdevice     Cross devices
  --basepath {none,common,full}
                        Select style of root path handling Default: none
  --deltathreshold DELTATHRESHOLD
                        If delta file is greater than this percentage of the
                        original, a full version is sent. Default: 66
  --version             Show the version
  --stats               Print stats about the transfer
  --report              Print a report on all files transferred
  --verbose, -v         Increase the verbosity
  --[no]log-exceptions  Log full exception details

Password/Encryption specification options:
  --password [PASSWORD], -P [PASSWORD]
                        Encrypt files with this password
  --password-file PASSWORDFILE, -F PASSWORDFILE
                        Read password from file. Can be a URL (HTTP/HTTPS or
                        FTP)
  --password-prog PASSWORDPROG
                        Use the specified command to generate the password on
                        stdout
  --[no]crypt           Encrypt data. Only valid if password is set
  --keys KEYS           Load keys from file. Keys are not stored in database

Arguments for running server locally under tardis:
  --[no]local           Run server as a local client
  --local-server-cmd SERVERPROG
                        Local server program to run

Backup naming options.  If nothing is explicitly set, the name will be chosen automatically:
  --name NAME, -n NAME  Set the backup name.
  --hourly, -H          Run an hourly backup
  --daily, -D           Run a daily backup
  --weekly, -W          Run a weekly backup
  --monthly, -M         Run a monthly backup

Exclusion options:
  Options for handling exclusions

  --[no]cvs-ignore      Ignore files like CVS
  --exclude EXCLUDES, -x EXCLUDES
                        Patterns to exclude globally (may be repeated)
  --exclude-file EXCLUDEFILES, -X EXCLUDEFILES
                        Load patterns from exclude file (may be repeated)
  --exclude-file-name EXCLUDEFILENAME
                        Load recursive exclude files from this. Default:
                        .tardis-excludes
  --exclude-dir EXCLUDEDIRS
                        Exclude certain directories by path
  --local-exclude-file-name LOCALEXCLUDEFILENAME
                        Load local exclude files from this. Default: .tardis-
                        local-excludes
  --skip-file-name SKIPFILENAME
                        File to indicate to skip a directory. Default:
                        .tardis-skip
  --ignore-global-excludes
                        Ignore the global exclude file

Communications options:
  Options for specifying details about the communications protocol. Mostly
  for debugging

  --[no]compress-msgs   Compress messages. Default: False
  --cks-content [CKSCONTENT]
                        Checksum files before sending. Can reduce run time if
                        lots of duplicates are expected. Default: 0
  --clones CLONES, -L CLONES
                        Maximum number of clones per chunk. 0 to disable
                        cloning. Default: 100
  --batchdir BATCHDIRS, -B BATCHDIRS
                        Maximum size of small dirs to send. 0 to disable
                        batching. Default: 16
  --batchsize BATCHSIZE
                        Maximum number of small dirs to batch together.
                        Default: 100
  --chunksize CHUNKSIZE
                        Chunk size for sending data. Default: 262144
  --dirslice DIRSLICE   Maximum number of directory entries per message.
                        Default: 1000
  --protocol {json,bson,msgp}
                        Protocol for data transfer. Default: msgp

Options for purging old backup sets:
  --[no]purge           Purge old backup sets when backup complete
  --purge-priority PURGEPRIOR
                        Delete below this priority (Default: Backup priority)
  --keep-days PURGEDAYS
                        Number of days to keep
  --keep-hours PURGEHOURS
                        Number of hours to keep
  --keep-time PURGETIME
                        Purge before this time. Format: YYYY/MM/DD:hh:mm

Options can be specified in files, with the filename specified by an @sign:
e.g. "tardis @args.txt" will read arguments from args.txt
</pre>
